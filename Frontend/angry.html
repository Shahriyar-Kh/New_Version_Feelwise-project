<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Angry Challenges</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="challenges.css">
  </head>
  <body>
     <header class="site-header">
    <div class="header-content">
      <div class="logo-container">
        <h1 class="logo">
          <i class="fas fa-brain"></i>
          FeelWise
        </h1>
      </div>
      <nav class="main-nav">
        <a href="#" class="nav-link"><i class="fas fa-home"></i> Home</a>
        <a href="#" class="nav-link"><i class="fas fa-chart-line"></i> Dashboard</a>
        <a href="#" class="nav-link"><i class="fas fa-history"></i> History</a>
        <a href="#" class="nav-link"><i class="fas fa-user"></i> Profile</a>
      </nav>
    </div>
  </header>
    <div class="particles-container" id="particles-container"></div>

    <div class="main-container">
      <div class="text-center">
        <h1 class="angry-title">üò† ANGRY CHALLENGES</h1>
      </div>

      <div class="angry-card" id="challenge-container">
        <div class="reset-notice">
          <i class="fas fa-lightbulb me-2"></i>
          <strong>Pro Tip:</strong> You can retake these challenges anytime by
          refreshing the page or clicking "Retake Challenges" after completion!
        </div>

        <div class="challenges-grid">
  <!-- Challenge 1 -->
  <div class="challenge-item">
    <div class="challenge-icon"><i class="fas fa-shield-alt"></i></div>
    <h2>üõ°Ô∏è Safe Space Setup</h2>
    <p>üí™ Power Workout ‚Äì Burn off energy with a 10-minute intense exercise</p>
    <button class="challenge-btn" onclick="acceptChallenge('safe')">Accept Challenge</button>
    <button class="complete-btn" id="safe-complete" onclick="completeChallenge('safe')"><i class="fas fa-check-circle me-2"></i>Completed</button>
    <div class="progress-wrapper"><div class="progress-bar" id="safe-progress"></div></div>
  </div>

  <!-- Challenge 2 -->
  <div class="challenge-item">
    <div class="challenge-icon"><i class="fas fa-pencil-alt"></i></div>
    <h2>üìù Rant & Rip</h2>
    <p>Write out your frustrations, then tear up the paper</p>
    <button class="challenge-btn" onclick="acceptChallenge('rant')">Accept Challenge</button>
    <button class="complete-btn" id="rant-complete" onclick="completeChallenge('rant')"><i class="fas fa-check-circle me-2"></i>Completed</button>
    <div class="progress-wrapper"><div class="progress-bar" id="rant-progress"></div></div>
  </div>

  <!-- Challenge 3 -->
  <div class="challenge-item">
    <div class="challenge-icon"><i class="fas fa-exchange-alt"></i></div>
    <h2>üö™ Change the Scene</h2>
    <p>Step outside or move to a different room for 5 minutes</p>
    <button class="challenge-btn" onclick="acceptChallenge('scene')">Accept Challenge</button>
    <button class="complete-btn" id="scene-complete" onclick="completeChallenge('scene')"><i class="fas fa-check-circle me-2"></i>Completed</button>
    <div class="progress-wrapper"><div class="progress-bar" id="scene-progress"></div></div>
  </div>

  <!-- Challenge 4 -->
  <div class="challenge-item">
    <div class="challenge-icon"><i class="fas fa-music"></i></div>
    <h2>üéµ Angry Playlist</h2>
    <p>Play your favorite high-energy music for 5 minutes</p>
    <button class="challenge-btn" onclick="acceptChallenge('music')">Accept Challenge</button>
    <button class="complete-btn" id="music-complete" onclick="completeChallenge('music')"><i class="fas fa-check-circle me-2"></i>Completed</button>
    <div class="progress-wrapper"><div class="progress-bar" id="music-progress"></div></div>
  </div>

  <!-- Challenge 5 -->
  <div class="challenge-item">
    <div class="challenge-icon"><i class="fas fa-bolt"></i></div>
    <h2>‚ö° Quick Sprint</h2>
    <p>Run or jog in place for 2 minutes to release tension</p>
    <button class="challenge-btn" onclick="acceptChallenge('sprint')">Accept Challenge</button>
    <button class="complete-btn" id="sprint-complete" onclick="completeChallenge('sprint')"><i class="fas fa-check-circle me-2"></i>Completed</button>
    <div class="progress-wrapper"><div class="progress-bar" id="sprint-progress"></div></div>
  </div>

  <!-- Challenge 6 -->
  <div class="challenge-item">
    <div class="challenge-icon"><i class="fas fa-water"></i></div>
    <h2>üíß Cool Off</h2>
    <p>Splash cold water on your face or wash your hands slowly</p>
    <button class="challenge-btn" onclick="acceptChallenge('cool')">Accept Challenge</button>
    <button class="complete-btn" id="cool-complete" onclick="completeChallenge('cool')"><i class="fas fa-check-circle me-2"></i>Completed</button>
    <div class="progress-wrapper"><div class="progress-bar" id="cool-progress"></div></div>
  </div>

  <!-- Challenge 7 -->
  <div class="challenge-item">
    <div class="challenge-icon"><i class="fas fa-dumbbell"></i></div>
    <h2>üèãÔ∏è Strength Burst</h2>
    <p>Do 20 push-ups or squats to channel your anger physically</p>
    <button class="challenge-btn" onclick="acceptChallenge('strength')">Accept Challenge</button>
    <button class="complete-btn" id="strength-complete" onclick="completeChallenge('strength')"><i class="fas fa-check-circle me-2"></i>Completed</button>
    <div class="progress-wrapper"><div class="progress-bar" id="strength-progress"></div></div>
  </div>

  <!-- Challenge 8 -->
  <div class="challenge-item">
    <div class="challenge-icon"><i class="fas fa-breathing"></i></div>
    <h2>üå¨Ô∏è Deep Breathing</h2>
    <p>Take 10 slow, deep breaths, counting each inhale and exhale</p>
    <button class="challenge-btn" onclick="acceptChallenge('breath')">Accept Challenge</button>
    <button class="complete-btn" id="breath-complete" onclick="completeChallenge('breath')"><i class="fas fa-check-circle me-2"></i>Completed</button>
    <div class="progress-wrapper"><div class="progress-bar" id="breath-progress"></div></div>
  </div>

  <!-- Challenge 9 -->
  <div class="challenge-item">
    <div class="challenge-icon"><i class="fas fa-book"></i></div>
    <h2>üìñ Redirect Focus</h2>
    <p>Read a short motivational story or an inspiring quote</p>
    <button class="challenge-btn" onclick="acceptChallenge('read')">Accept Challenge</button>
    <button class="complete-btn" id="read-complete" onclick="completeChallenge('read')"><i class="fas fa-check-circle me-2"></i>Completed</button>
    <div class="progress-wrapper"><div class="progress-bar" id="read-progress"></div></div>
  </div>

  <!-- Challenge 10 -->
  <div class="challenge-item">
    <div class="challenge-icon"><i class="fas fa-smile"></i></div>
    <h2>üòä Gratitude List</h2>
    <p>Write down 3 things you‚Äôre thankful for right now</p>
    <button class="challenge-btn" onclick="acceptChallenge('gratitude')">Accept Challenge</button>
    <button class="complete-btn" id="gratitude-complete" onclick="completeChallenge('gratitude')"><i class="fas fa-check-circle me-2"></i>Completed</button>
    <div class="progress-wrapper"><div class="progress-bar" id="gratitude-progress"></div></div>
  </div>
</div>


        <button id="submit-challenges-btn" onclick="submitAllChallenges()">
          <i class="fas fa-paper-plane me-2"></i>Submit All Challenges
          <span
            id="submit-loading"
            class="loading-spinner"
            style="display: none"
          ></span>
        </button>
      </div>

      <div class="success-card text-center" id="success-card">
        <h2><i class="fas fa-trophy me-2"></i>WELL DONE!</h2>
        <p>You successfully completed all Angry challenges!</p>
        <p>Your frustration has been transformed into positive energy!</p>
        <p id="save-status" style="color: var(--success); font-size: 14px"></p>
        <div class="mt-4">
          <button onclick="goToProgress()">
            <i class="fas fa-chart-line me-2"></i>View Progress
          </button>
          <button class="retake-btn" onclick="retakeChallenges()">
            <i class="fas fa-redo me-2"></i>Retake Challenges
          </button>
        </div>
      </div>
    </div>
    <footer class="site-footer">
    <div class="footer-content">
      <div class="footer-section">
        <h3>FeelWise</h3>
        <p>Understanding emotions through AI-powered analysis</p>
      </div>
      <div class="footer-section">
        <h4>Resources</h4>
        <a href="#">Blog</a>
        <a href="#">Guides</a>
        <a href="#">Support</a>
      </div>
      <div class="footer-section">
        <h4>Company</h4>
        <a href="#">About Us</a>
        <a href="#">Careers</a>
        <a href="#">Contact</a>
      </div>
      <div class="footer-section">
        <h4>Connect</h4>
        <div class="social-links">
          <a href="#"><i class="fab fa-twitter"></i></a>
          <a href="#"><i class="fab fa-facebook"></i></a>
          <a href="#"><i class="fab fa-instagram"></i></a>
          <a href="#"><i class="fab fa-linkedin"></i></a>
        </div>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; 2023 FeelWise. All rights reserved.</p>
      <div class="footer-links">
        <a href="#">Privacy Policy</a>
        <a href="#">Terms of Service</a>
        <a href="#">Cookie Policy</a>
      </div>
    </div>
  </footer>


    <script>
      const API_BASE = "http://localhost:5000/api";
     let challenges = { 
  safe: 0, rant: 0, scene: 0, 
  music: 0, sprint: 0, cool: 0, 
  strength: 0, breath: 0, read: 0, gratitude: 0 
};

      // Create animated particles
      function createParticles() {
        const container = document.getElementById("particles-container");
        const particleCount = 20;

        for (let i = 0; i < particleCount; i++) {
          const particle = document.createElement("div");
          particle.classList.add("particle");

          // Random properties
          const size = Math.random() * 20 + 5;
          const posX = Math.random() * 100;
          const posY = Math.random() * 100;
          const delay = Math.random() * 10;
          const duration = 10 + Math.random() * 20;

          particle.style.width = `${size}px`;
          particle.style.height = `${size}px`;
          particle.style.left = `${posX}vw`;
          particle.style.top = `${posY}vh`;
          particle.style.animationDelay = `${delay}s`;
          particle.style.animationDuration = `${duration}s`;

          // Add flame effect to some particles
          if (Math.random() > 0.7) {
            particle.classList.add("flame");
          }

          container.appendChild(particle);
        }
      }

      async function markChallengeComplete(key) {
        const token = localStorage.getItem("token");
        try {
          if (token) {
            await fetch(`${API_BASE}/progress/complete-challenge`, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${token}`,
              },
              body: JSON.stringify({ mood: "angry", challenge: key }),
            });
            return "database";
          } else {
            // Save multiple completions locally
            let completed = JSON.parse(
              localStorage.getItem("completedChallenges") || "[]"
            );
            completed.push({ mood: "angry", challenge: key, time: Date.now() });
            localStorage.setItem(
              "completedChallenges",
              JSON.stringify(completed)
            );
            return "localStorage";
          }
        } catch (err) {
          console.error(err);
          return "localStorage";
        }
      }

      function acceptChallenge(key) {
        challenges[key] = 50;
        document.getElementById(key + "-progress").style.width = "50%";
        document.getElementById(key + "-complete").style.display =
          "inline-block";

        // Add visual feedback
        const btn = document.querySelector(
          `button[onclick="acceptChallenge('${key}')"]`
        );
        btn.classList.add("btn-accepted");
        btn.innerHTML = '<i class="fas fa-check me-2"></i>Accepted';
      }

      async function completeChallenge(key) {
        challenges[key] = 100;
        document.getElementById(key + "-progress").style.width = "100%";
        document.getElementById(key + "-complete").style.display = "none";
        await markChallengeComplete(key); // record completion each time
        checkSubmit();
      }

      function checkSubmit() {
        if (Object.values(challenges).every((v) => v === 100)) {
          document.getElementById("submit-challenges-btn").style.display =
            "block";
        }
      }

      function submitAllChallenges() {
        document.getElementById("challenge-container").style.display = "none";
        document.getElementById("success-card").style.display = "block";
        document.getElementById("save-status").textContent =
          "üéØ Progress recorded! You can retake the challenges anytime.";
      }

      function retakeChallenges() {
        // Reset all challenges programmatically
        resetAllChallenges();
      }

      function resetAllChallenges() {
        challenges = { safe: 0, rant: 0, scene: 0 };
        document.getElementById("challenge-container").style.display = "block";
        document.getElementById("success-card").style.display = "none";
        document.getElementById("submit-challenges-btn").style.display = "none";
        document
          .querySelectorAll(".progress-bar")
          .forEach((bar) => (bar.style.width = "0%"));
        document
          .querySelectorAll(".complete-btn")
          .forEach((btn) => (btn.style.display = "none"));

        // Reset accept buttons
        document.querySelectorAll(".challenge-btn").forEach((btn) => {
          btn.innerHTML = "Accept Challenge";
          btn.classList.remove("btn-accepted");
        });
      }

      function goToProgress() {
        window.location.href = "progress.html";
      }

      // Initialize on load
      window.addEventListener("DOMContentLoaded", function () {
        createParticles();
        resetAllChallenges();
      });
    </script>
  </body>
</html>